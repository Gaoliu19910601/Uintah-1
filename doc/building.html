<h1>Things You Need To Know About How To Build the PSE</h1>

<h3>1 - Configuring your environment</h3>

  Before you can build PSE, you need to appropriately configure your
  environment.  Most of this requires making changes to your shell rc files
  (.cshrc, .customs.cshrc, .kshrc, .bashrc or whatever your shell uses).
  You need only perform these steps once.<p>

  <h4>1.1 - Putting stuff on your PATH</h4>

  You should edit your shell's rc files and make sure that the following
  are on your PATH:<p>

  <ul><code>
    /usr/local/bin       (for the 'use' and 'ssh' commands)<br>
    /usr/local/gnu/bin   (for the 'gmake', 'cvs', and 'patch' commands)
  </code></ul>

  If you have other versions of these commands on your PATH before the
  above versions, you may or may not encounter Strange Behavior.<p>

  <h4>1.1 - Getting ssh access to csf</h4>

  The PSE sources are kept on the C-SAFE server, csf.cs.utah.edu.  You must
  be able to ssh to this machine in order to aquire the sources.  Most people
  already have access to this machine.  At a prompt (in these examples, "$" is
  the prompt), type:<p>

  <ul><code>
    $ ssh csf
  </code></ul>

  You may be asked for your password, but should successfully be able to log
  into csf.  If not, go talk to Someone Who Fixes These Things and get it
  fixed.<p>

  If you hate typing your password all the time, you may optionally add a
  line like:<p>

  <ul><code>
    pico.cs.utah.edu mcq
  </code></ul>

  to your ".shosts" file in your home directory, where you substitute the
  name of the machine on which you're going to be running the CVS command for
  "pico.cs.utah.edu" and your username for "mcq".  Doing this tells csf
  (and all other machines on which your home directory is accessible) to
  allow the named user to have ssh access from the named machine without typing
  a password.<p>

  There are more complex and "secure" methods to avoid typing a password than
  an .shosts file, but they're for Weird Security Nuts.<p>

  <h4>1.2 - Setting up CVS</h4>

  The PSE source tree is managed by CVS.  CVS uses the "ssh" command to
  access the source repository on csf.cs.utah.edu.<p>

  You should look in your shell's rc files and arrange for these variables to
  have these values.  In csh syntax:<p>

  <ul><code>
    setenv CVS_RSH ssh<br>
    setenv CVSROOT csf.cs.utah.edu:/csafe_noexport/cvs/cvsroot
  </code></ul>

  In sh/ksh/bash syntax:<p>

  <ul><code>
    export CVS_RSH=ssh<br>
    export CVSROOT=csf.cs.utah.edu:/csafe_noexport/cvs/cvsroot
  </code></ul>

  <h4>1.3 - Getting Rid Of Cruft</h4>

  Previous versions of SCIrun may cause some
  troublesome settings to exist in your environment.  To put this
  issue to rest, you should make sure that the following are **NOT** set
  by any of your shell's rc files, nor should you run any form of "setup"
  scripts unless you Really Know What You're Doing.<p>

  The PSE is intended to run correctly without such enviromental
  contamination.  If things in the PSE don't work right, fix the PSE --
  demanding that weirdo environment variables be set merely to achieve
  normal PSE behavior is the Wrong Way To Solve The Problem.  If you
  have problems that you think you want to set an environment variable to
  fix, which are things anyone but you will normally want to have set, you
  should go talk to McQ and he'll work configure magic to eliminate
  the need for the variable.<p>

  The following should NOT BE SET in your shell rc files.  EVER.  PERIOD.
  (Unless you're Very Special, in which case you wouldn't be reading this
  file):<p>

  <ul><code>
    TCL_LIBRARY<br>
    TK_LIBRARY<br>
    ITCL_LIBRARY<br>
    ITK_LIBRARY<br>
    PACKAGE_PATH<br>
  </code></ul>

  Also, nothing to do with Tcl, Tk, or iTcl, PSECore, SCICore, or any
  PSE package should be on any of these paths:<p>

  <ul><code>
    PATH
    LD_LIBRARY_PATH<br>
    LD_LIBRARYN32_PATH<br>
    LD_LIBRARY64_PATH<br>
  </code></ul>

  Having any of the above defined is Just Asking For Trouble.<p>

<h3>2 - Checking out and Building PSE</h3>

  <h4>2.1 - Log into a build machine</h4>

  The best build machine is pico.cs.utah.edu (formerly rapture.cs.utah.edu),
  a 32-processor SGI R10k machine.  If you can't log into pico,
  epic.cs.utah.edu is a good interim solution.  You'll likely eventually want
  to get an account on pico.<p>

  <ul><code>
     $ ssh pico
  </code></ul>

  <h4>2.2 - Checking out the PSE sources with CVS</h4>

  The PSE sources are managed by the CVS version control system.  Go to
  whatever directory you want to work in and check out the sources:<p>

  <ul><code>
     $ cd myWorkingDirectory<br>
     $ cvs checkout PSE
  </code>

     [ lots of files go by]
  </ul>

  When you're done, if you go into the PSE directory, you should see:<p>

  <ul><code>
     $ cd PSE<br>
     $ ls<br>
     CVS       prebuilt  src
  </code></ul>

  <h4>2.3 - Setting up 'use'</h4>

  Building the PSE requires that you have a specific version of Tcl/Tk and
  [incr Tcl] available.  Because you may be building the PSE for several
  different ABIs on several different platforms, it is not sufficient to
  "once and for all" configure your environment for the appropriate versions
  of [i]Tcl/Tk.<p>

  The 'use' command will let you easily switch among available pre-built
  versions of [i]Tcl/Tk as you work.  If curious, you can read about 'use'
  on its web page (under construction at this time):<p>

  <ul><code>
    http://www.cs.utah.edu/~mcq/doc/use.html
  </code></ul>

  You need to add a line that enables 'use' to modify your shell's
  environment.  You should set this in your shell's rc files.  In csh, this
  line is:<p>

  <ul><code>
    alias use 'eval `/usr/local/bin/use \!*`'
  </code></ul>

  In sh/ksh/bash, add the shell function to the appropriate rc file:<p>

  <ul><code>
    use() {<br>
    <ul>
      eval `/usr/local/bin/use $*`<br>
    </ul>
    }<br>
  </code></ul>

  If you type 'use' at a command prompt and do not see a message which
  begins "# WARNING", you have correctly configured your shell for the 'use'
  command.<p>

  <h4>2.4 - Use [i]Tcl/Tk</h4>

  In order to properly function, the PSE requires that Tcl/Tk 8.0.4 and
  [incr Tcl] 3.0.1 be available in your environment.  The command:<p>

  <ul><code>
     $ use itcltk
  </code></ul>

  will achieve this.  When building for the 64-bit ABI on R10k boxes, you'll
  want to 'use itcltk64' instead, to get the version of [i]Tcl/Tk built for
  that ABI.<p>

  <h4>2.5 - Configure the sources</h4>

  Before you can build the sources, you must "configure" the source tree,
  which examines your build platform and customizes the PSE's Makefiles
  for your machine.<p>

  Go into the PSE/src directory and run the "configure" script:<p>

  <ul><code>
    $ cd PSE/src<br>
    $ ./configure
  </code></ul>

  You may optionally want to pass options to configure as described
  <a href="configure.html">here</a> to enable for example the SCIRun
  or DaveW packages.  The Uintah package is built by default. The names
  of packages are strung together, space-delimited: <p>
  
  <ul><code>
    $ cd PSE/src<br>
    $ ./configure --enable-package="SCIRun Uintah DaveW"
  </code></ul>

  <h4>2.6 - Build the sources</h4>

  You must build the sources with the 'gmake' command.  Ordinary 'make's
  won't do.  From the PSE/src directory:<p>

  <ul><code>
    $ gmake 
  </code></ul>

  If you are doing the build on a multiprocessor machine, you can speed up the
  compile by using the j flag to direct the compiler to parallelize the build
  on, say 10 processors:<p> 

  <ul><code>
    $ gmake -j 10 
  </code></ul>

  <h4>2.7 - Updating and rebuilding the sources</h4>

  Typically the fastest way to retrieve and build all the changes to
  the source tree is via an update rather than a complete checkout. Before
  the checkout, be sure that you do not have a recurse.mk file in your
  source tree: <p>
 
  <ul><code>
    $ rm scripts/recurse.mk
    $ cvs update -d 
  </code></ul>
  

<h3>3 - Starting the PSE</h3>

  When finished building, you'll have a "pse" binary in PSE/src which you
  can run to start the PSE.  This binary has hard-coded paths to the locations
  of its components, including the PSE packages, the [i]Tcl/Tk libraries and
  files, and others.<p>

  You can run the PSE simply by running 'pse' in the PSE/src directory:<p>

  <ul><code>
    $ cd PSE/src<br>
    $ ./pse
  </code></ul>

  <h4>3.1 - A note about 'use'</h4>

  The first time that the 'use' command is run on a machine, it creates a
  link from /tmp/opt/... to the actual [i]Tcl/Tk package.  The PSE requires
  that this link be present in order to run (its hard-coded path to the
  [i]Tcl/Tk libraries points to this link).<p>

  If you're running the PSE on a machine for the first time since it has been
  rebooted, this link will not exist and you must execute "use itcltk" to
  recreate it.<p>

  You normally need not execute "use itcltk" before each run of the PSE.<p>

  If you only ever build with the default (n32) ABI, you might consider
  adding the line "use itcltk" (and perhaps also "use gmake") to your 
  shell's rc files, to avoid thinking
  about such things.  The disadvantage to doing this is that "itcltk" may
  not be compiled for some cs department architectures, causing 'use' to
  report an error when logging into those machines.<p>
