<?xml version="1.0" encoding="UTF-8" ?>

<!--

  This is supposed to be a valid xhtml file!  Please visit
  http://validator.w3.org after editing this file.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="HTML Tidy for Mac OS X (vers 1st December 2002), see www.w3.org"
      name="generator" />
    <title>
      BioFEM Tutorial
    </title>

    <style type="text/css">
      body {
      background: #999999;
      margin-top: 0px;
      margin-bottom: 0px;
      }
      div.body {
      background: #CCCCCC;
      margin-left: 8%;
      padding-left: 2%;
      margin-right: 5%;
      padding-right: 2%;
      padding-bottom: 1em;
      padding-top: 1em;
      }
      pre {
      margin-left: 2%;
      }
      dt {
      font-weight: bold;
      }
      dd {
      margin-left: 2%;
      margin-bottom: 0.5em;
      }
      ins {
      color: black;
      background-color: #FF8800;
      text-decoration: none;
      }
      caption {
      margin-top: 1em;
      }
      table {
      border-collapse: collapse;
      margin-bottom: 1em;
      }
      th {
      text-align: left;
      }
      th, td {
      border: thin solid #999999;
      padding: 2px;
      }
    </style>

  </head>

  <body>
    <div class="body">
      <center>
	<img src="images/biofem-banner-main.gif" alt="BioFEM Banner"
	  usemap="#femt-banner-main" border="0" alt="Top Banner"/> 
      </center>

      <map id="femt-banner-main" name="femt-banner-main">
	<area shape="rect" coords="405,170,497,194" href="http://www.sci.utah.edu" alt="SCI Web Site" />
	<area shape="rect" coords="510,172,590,193" href="http://software.sci.utah.edu"  alt="SCI Software Site" />
      </map>
      <h2>
	Contents
      </h2>
      <h3>
	Sections
      </h3>
      <ol>
	<li value="1">
	  <a href="#section_1">Introduction</a>
	</li>
	<li value="2">
	  <a href="#section_2">Getting Started</a> 
	  <ol>
	    <li value="1">
	      <a href="#section_2_1">Preparations</a>
	    </li>
	    <li value="2">
	      <a href="#section_2_2">Launching BioFEM</a>
	    </li>
	    <li value="3">
	      <a href="#section_2_3">User Interface Organization</a>
	    </li>
	  </ol>
	</li>
	<li value="3">
	  <a href="#section_3">Initial Processing and Visualization</a>
	</li>
	<li value="4">
	  <a href="#section_4">Visualization</a> 
	  <ol>
	    <li value="1">
	      <a href="#section_4_1">Viewer Options Tab</a>
	    </li>
	    <li value="2">
	      <a href="#section_4_2">Vis Options Tab</a>
	    </li>
	    <li value="3">
	      <a href="#section_4_3">IsoSurface</a>
	    </li>
	    <li value="4">
	      <a href="#section_4_4">Streamlines</a>
	    </li>
	    <li value="5">
	      <a href="#section_4_5">Electrodes</a>
	    </li>
	    <li value="6">
	      <a href="#section_4_6">Colormap</a>
	    </li>
	  </ol>
	</li>
      </ol>
      <h3>Appendices</h3>
      <ol type="A">
	<li><a href="#appendix_a">Data Formats and Preparation</a></li>
      </ol>
      <h3>Tables</h3>
      <ul>
	<li>
	  <a href="#table_1">Rendering Window's Mouse Controls</a>
	</li>
      </ul>
      <h3>Figures</h3>
      <ul>
	<li>
	  <a href="#figure_1">Figure 1: BioFEM Interface
	    Window</a>
	</li>
	<li>
	  <a href="#figure_2">Figure 2: BioFEM Interface
	    Window (Detached Panes)</a>
	</li>
	<li>
	  <a href="#figure_3">Figure 3: File Menu</a>
	</li>
	<li>
	  <a href="#figure_4">Figure 4: Help Menu</a>
	</li>
	<li>
	  <a href="#figure_5">Figure 5: Initial Visualization</a>
	</li>
	<li>
	  <a href="#figure_6">Figure 6: Viewer Options Tab </a>
	</li>
	<li>
	  <a href="#figure_7">Figure 7: Vis Options Tab </a>
	</li>
	<li>
	  <a href="#figure_8">Figure 8: Isosurface Visualization</a>
	</li>
	<li>
	  <a href="#figure_9">Figure 9: Streamlines Visualization</a>
	</li>
	<li>
	  <a href="#figure_10">Figure 10: Electrodes Visualization</a>
	</li>
	<li>
	  <a href="#figure_11">Figure 11: Visualization with
	    Red-to-Blue color-map</a>
	</li>
      </ul>

      <a name="section_1" id="section_1"/>
      <h2>Section 1&ndash;Introduction</h2>
      <p>
	BioFEM is a SCIRun PowerApp that computes the electric field
	in a volume produced by a set of dipoles. BioFEM computes a
	solution to the bioelectric field forward problem.  BioFEM
	also computes voltage values at electrode positions, which can
	be compared with values recorded via ECG or EKG.
      </p>

      <p>
	BioFEM requires these inputs:
      </p>
      <ul>
	<li><p>A discretized volume with associated volume element conductivities.</p></li>
	<li><p>An electric field modeling a dipole source.</p></li>
	<li><p>The positions of a set of measurement electrodes.</p></li>
      </ul>

      <p>
	<a href="#appendix_a">Appendix A</a> gives instructions for
	preparing these data.  However, this tutorial uses BioFEM to
	process and visualize the Utah Torso data set. No data set
	preparations are needed to run this tutorial.  The Utah Torso
	data set is part of the SCIRun sample data set collection, and
	can be <a
	href="http::software.sci.utah.edu/datasets/SCIRunData.1.20.0.tar.gz">downloaded</a>
	from SCI's web site.
      </p>

      <a name="section_2" id="section_2"/>
      <h2>Section 2&ndash;Getting Started</h2>
      <p>
	This section demonstrates how to start BioFEM. Subsequent
	sections demonstrate how to load, process, and visualize data.
      </p>
      
      <a name="section_2_1" id="section_2_1"/>
      <h3>2.1 Preparations</h3>

      <p>
	Before starting BioFEM, the environment variables SCIRUN_DATA,
	SCIRUN_DATASET, and SCIRUN_ON_THE_FLY_LIBS_DIR must be set.
      </p>
      <p>
	SCIRUN_DATA points to the sample data sets directory.
	This tutorial assumes the SCIRun sample data directory is
	<tt>/usr/sci/data/SCIRunData/1.20.0</tt>. So, SCIRUN_DATA is
	set to (for a csh-like shell):
      </p>
      <pre>
setenv SCIRUN_DATA /usr/sci/data/SCIRun/SCIRunData/1.20.0
      </pre>
      <p>
	SCIRUN_DATASET points to a specific data set directory
	within the data directory.
      </p>

      <p>
	The Utah Torso data set exists in high resolution and low
	resolution versions.  
      </p>	
	
      <p>
        To use the high resolution data set,
	SCIRUN_DATASET must be set to "utahtorso":
      </p>

      <pre>
setenv SCIRUN_DATASET utahtorso
      </pre>

      <p>
	To use the low resolution dataset, SCIRUN_DATASET must be set
	to "utahtorso-lowres":
      </p>

      <pre>
setenv SCIRUN_DATASET utahtorso
      </pre>

      <p>
	This tutorial uses the low resolution data set.
      </p>

      <p>
	SCIRUN_ON_THE_FLY_LIBS_DIR points to an "on the fly libs"
	directory.  It should be set as follows:
      </p>
      <pre>
mkdir ~/on-the-fly-libs
setenv SCIRUN_ON_THE_FLY_LIBS_DIR ~/on-the-fly-libs
      </pre>

      <p>
	When running BioFEM on Apple's OSX operating system, the limit on
	the number of open files must be increased.
      </p>
      
      <p>
	for csh-like shells type:
      </p>

      <pre>
limit descriptors unlimited
      </pre>
      <p>for sh-like shells type:</p>
      <pre>
ulimit -n unlimited
      </pre>


      <a name="section_2_2" id="section_2_2"/>
      <h3>2.2 Launching BioFEM</h3>
      <p>
	Change the working directory (using the <span
	class="cmd">cd</span> command) to the directory containing the
	BioFEM executable.  This directory will be
	<tt>/usr/local/SCIRun/bin/</tt> if SCIRun has been installed
	via RPM.  Then type <tt>./BioFEM</tt> to start BioFEM:
      </p>
      <pre>
cd /usr/local/SCIRun/bin
./BioFEM
      </pre>

      <p>
	BioFEM takes a few moments to start up, then displays
	the window shown in <a href="#figure_1">Figure 1.</a>
      </p>
      <br /> <br />

      <a name="figure_1" id="figure_1"/>
      <center>
	<a href="figures/biofem-load.gif"><img border="1"
	    src="figures/biofem-load-small.gif" alt="BioFEM
	    Application Window"/></a>
	<br />
	<b>Figure 1: BioFEM Interface Window (Initial
	  State).</b>
      </center>
      <br />

      <a name="section_2_3" id="section_2_3"/>
      <h3>2.3 User Interface Organization</h3>

      <p>
	The BioFEM window contains two panes.  The Rendering Pane is
	on the left side of the window. All data interaction and
	visualization is performed in the Rendering Pane. The
	Visualization Pane is on the right side of the window. The
	Visualization Pane guides the user through the application, and
	controls visualization parameters for the Rendering
	window. The panes may be "detached" from one another by
	clicking on the pane detachment/attachment
	controls&mdash;these are the vertical dashed lines separating
	the panes. When separated, the panes appear as shown in <a
	href="#figure_2">Figure 2.</a> Detaching the Rendering window
	allows it to be viewed at maximum resolution.  Panes are
	re-attached by clicking on the pane
	detachment/attachment controls.
      </p>
      <br />
      <br />

      <a name="figure_2" id="figure_2"/>
      <center>
	<a href="figures/biofem-panes.gif">
	  <img border="1" src="figures/biofem-panes-small.gif"
	    alt="BioFEM Application detached Windows"/></a><br />
	<b>Figure 2: BioFEM Interface Window (Detached State)</b>
      </center>

      <p>
	The Rendering window contains two top-level menus: File and
	Help.  The File menu, shown in <a
	href="#figure_3">Figure&nbsp;3</a> contains the following items.
      </p>

      <dl>
	<dt>Load Session...</dt>
	<dd>Loads a previously saved session.</dd>
	<dt>Save Session...</dt>
	<dd>Saves a session, which can be resumed later.</dd>
	<dt>Save Session As...</dt>
	<dd>Saves a session under a new name.</dd>
	<dt>Save Image...</dt>
	<dd>Saves the content of the Rendering pane as an image.</dd>
	<dt>Quit</dt>
	<dd>Quits BioFEM.</dd>
      </dl>

      <p>
	The user is not required to complete all processing steps
	before exiting BioFEM.  A BioFEM session can be stopped and
	resumed using File menu items Save Session... (or Save
	Session As...)  and Load Session.., respectively.  After
	loading a saved session with Load Session..., resume processing and
	visualization by clicking Execute.
      </p>
      <br/><br/>

      <center>
	<a name="figure_3" id="figure_3"/>
	<img src="figures/biofem-file.gif"
	  alt="File Menu"/><br />
	<b>Figure 3: File Menu.</b>
      </center>
      <br/><br/>

      <p>
	The Help menu, shown in <a href="#figure_4">Figure&nbsp;4</a>,
	contains these items:
      </p>

      <dl>
	<dt>Show Tooltips</dt>
	<dd>A checkbox that toggles tooltips on and off.</dd>
	<dt>Help Contents</dt>
	<dd></dd>
	<dt>About BioFEM</dt>
	<dd>Provides information about BioFEM.</dd>
      </dl>
      <br/><br/>
      
      <center>
	<a name="figure_4" id="figure_4"/>
	<img border="1" src="figures/biofem-help.gif"
	  alt="Help Menu"/><br />
	<b>Figure 4: Help Menu.</b>
      </center>

      <p>
	A Progress Indicator and an Execute button are found at the
	bottom of the Visualization Pane.  The Execute button starts
	the current processing step&mdash;it is pressed after
	parameters for the current processing step have been set.  The
	Progress Indicator shows how much of the current processing
	step has been completed.  Text above the Progress Indicator
	describes the current state of processing, and suggests the
	next processing step.
      </p>


      <a name="section_3" id="section_3"/>
      <h2>Section 3&ndash;Initial Processing and Visualization</h2>

      
      <p>
	After starting BioFEM, the Visualization pane shows the
	contents of the Data Selection tab.  Verify that the Utah
	Torso Lowres radio button is selected.
      </p>

      <p>
	Click Execute to begin initial processing.  During this step,
	a solution to the forward problem will be computed.  This may
	take a few minutes.  The Progress Indicator will be "busy"
	during this time.  The Progress Indicator will show "COMPLETE"
	when processing is finished.
      </p>

      <p>
	Perform these steps to view results in the Rendering window:
      </p>

      <ol>
	<li>Click on the tab labeled "Viewer Options".</li>

	<li>Click on the Views pop-up menu, select menu item
	"Look down -Y axis", then select sub-menu item "Up vector +Z".
	</li>
      </ol>

      <p>
	The Rendering window should look like the Rendering window
	shown in <a href="#figure_5">Figure 5</a>.  The Rendering
	window shows the outer boundary of the torso volume, the set
	of measurement electrodes, the zero-voltage isosurface, and
	streamlines that follow voltage gradients. The electrodes,
	isosurface, and streamlines are color coded to show negative
	voltages blue and positive voltages red.
      </p>

      <a name="figure_5" id="figure_5"/>
      <center>
	<img border="1" src="figures/biofem-vis-all.jpg"
	  alt="Initial Visualization"/><br />
	<b>Figure 5: Initial Visualization.</b>
      </center>
      <br />
      <br />

      <p>
	Interaction with the Rendering window is performed with the
	mouse.  The Rendering window's scene can be translated,
	zoomed, rotated, etc.  <a href="#table_1">Table 1</a> shows
	all mouse actions.  See also <a
	href="../../Guide/usersguide/srug6_3.html">6.3 of User's Guide
	(Mouse Control in the Viewer Window)</a> for more information.
      </p>

      <a name="table_1" id="table_1"/>
      <center>
	<table>
	  <caption><b>Table 1</b>: Rendering Window's Mouse Controls</caption>
	  <thead>
	    <tr>
	      <th></th>
	      <th>Modifier Key</th>
	      <th>Mouse Button</th>
	      <th>Renderer Window Action</th>
	    </tr>
	  </thead>
	  <tbody>
	    <tr>
	      <td rowspan="6"><b>Scene<br/>Controls</b></td>
	      <td rowspan="3">none</td>
	      <td>Left</td>
	      <td>Translate scene</td>
	    </tr>
	    <tr>
	      <td>Middle</td>
	      <td>Rotate scene</td>
	    </tr>
	    <tr>
	      <td>Right</td>
	      <td>Zoom scene</td>
	    </tr>
	    <tr>
	      <td rowspan="3">Control</td>
	      <td>Left</td>
	      <td>Translate scene in Z-direction</td>
	    </tr>
	    <tr>
	      <td>Middle</td>
	      <td>Rotate the camera view about the eye point</td>
	    </tr>
	    <tr>
	      <td>Right</td>
	      <td>Unicam movement</td>
	    </tr>
	    <tr>
	      <td rowspan="3"><b>Rake Widget<br />Controls</b></td>
	      <td rowspan="3">Shift</td>
	      <td>Left</td>
	      <td>Position and orient rake widget</td>
	    </tr>
	    <tr>
	      <td>Middle</td>
	      <td>Toggle widget's modes</td>
	    </tr>
	    <tr>
	      <td>Right</td>
	      <td>Display widget help window</td>
	    </tr>
	  </tbody>
	</table>
      </center>

      <a name="section_4" id="section_4"/>
      <h2>Section 4&ndash;Visualization</h2>


      <a name="section_4_1" id="section_4_1"/>
      <h3>4.1 Viewer Options Tab</h3>

      <p>
	<a href="#figure_6">Figure 6</a> shows the Visualization
	Pane's Viewer Options tab.  The Viewer Options tab provides
	controls for changing the properties of the Rendering Window.
	"Hovering" the mouse pointer over a control (e.g., Views
	pop-up menu button) displays a tooltip describing a control.
      </p>

      <a name="figure_6" id="figure_6"/>
      <center>
	<img border="1" src="figures/biofem-viewer-options-tab.gif"
	  alt="Viewer Options Tab"/><br />
	<b>Figure 6: Viewer Options Tab</b>
      </center>
      <br />


      <a name="section_4_2" id="section_4_2"/>
      <h3>4.2 Vis Options Tab</h3>

      <p>
	<a href="#figure_7">Figure 7</a> shows the Visualization
	Pane's Vis Options tab.  Controls in the Vis Options tab allow
	selection of visualization type, visualization parameters, and
	color map.  Visualizations can be viewed individually or
	together. For example, <a href="#figure_5">Figure 5</a> shows
	concurrent visualization of streamlines, zero-voltage
	iso-surface, and electrodes.
      </p>

      <p>
	Visualization types and use of color-maps are demonstrated in
	the following sections.
      </p>

      <a name="figure_7" id="figure_7"/>
      <center>
	<img border="1" src="figures/biofem-vis-options-tab.gif"
	  alt="Vis Options Tab"/><br />
	<b>Figure 7: Vis Options Tab</b>
      </center>
      <br />
      

      <a name="section_4_3" id="section_4_3"/>
      <h3>4.3 IsoSurface Visualization</h3>

      <p>
	An iso-surface is a surface of constant value. <a
	href="#figure_8">Figure 8</a> shows an iso-potential surface
	of value 0.  The visualization in <a
	href="#figure_8">Figure 8</a> is produced by selecting the
	checkbox labeled "Show IsoSuface", and selecting a voltage
	value of 0 using the Isoval control.
      </p>
      <p>
	The checkbox labeled "Interpolate Smooth Normals" 
	turns surface smoothing on and off. Smoothing improves
	iso-surface appearance, but hides iso-surface mesh details.
      </p>
      <br/>
      <br/>
      
      <a name="figure_8" id="figure_8"/>
      <center>
	<img border="1" src="figures/biofem-vis-isosurface.jpg"
	  alt="Isosurface Visualization" />
	<br />
	<b>Figure 8: Isosurface Visualization.</b>
      </center>
      <br />
      <br />

      <a name="section_4_4" id="section_4_4"/>
      <h3>4.4 Streamlines Visualization</h3>
      <p>
	Streamlines are  traces of paths particles take along
	voltage gradients. The rake widget is used to establish (or
	seed) initial particle positions within the electric field.
	Particles follow paths that start at one end of the dipole,
	pass through the rake, and end at the other side of the dipole.
	<a href="#figure_9">Figure 9</a> shows streamlines
	visualization.
      </p>
      
      <p>
	Streamlines visualization is controlled by the rake widget and
	controls in the Vis Options tab.
      </p>

      <p>
	The rake widget's position and orientation determine
	streamline paths.  The mouse is used to translate, rotate, and
	resize the rake widget.  In each case, the Shift key and the
	left mouse button are pressed while dragging a component of
	the rake.  Drag the rake's blue bar to translate the rake.
	Drag one of the rake's blue spheres to rotate the rake.  Drag
	one of the rakes green ends to resize the rake.  The
	streamlines are redrawn after the rake is
	moved.
      </p>

      <p>
	In the Vis Options tab, the slide bar labeled "Seeds" selects
	the number of seed points along the rake widget.  Seed points
	are evenly spaced.
      </p>
      
      <p>
	Streamlines are computed using a "fast" or  an "adaptive"
	algorithm.  One or the other algorithm is selected using the
	radio buttons labeled "Fast" and "Adaptive".  The fast method
	walks the mesh directly and is accurate to within the
	constraints of how the model is segmented. The slower
	computation method interpolates between the different cells in
	the mesh and can thus walk over discontinuities better and
	makes for a smoother streamline appearance.
      </p>

      <br />
      <br />

      <a name="figure_9" id="figure_9"/>
      <center>
	<img border="1" src="figures/biofem-vis-streamlines.jpg"
	  alt="Streamlines Visualization"/><br />
	<b>Figure 9: Streamlines Visualization.</b>
      </center>
      <br />
      <br />

      <a name="section_4_5" id="section_4_5"/>
      <h3>4.5 Electrodes Visualization</h3>

      <p>
	Visualize electrodes (typically on the torso surface) by
	checking the "Show Electrodes" checkbox in the Vis Options
	tab.  Electrodes are displayed as spheres.  Voltage values are
	computed at each electrode position.  Voltage values are color
	coded.  <a href="#figure_10">Figure 10</a> shows electrodes
	visualization.
      </p>
      <br />
      <br />

      <a name="figure_10" id="figure_10"/>
      <center>
	<img border="1" src="figures/biofem-vis-electrodes.jpg"
	  alt="Electrodes Visualization"/><br />
	<b>Figure 10: Electrodes Visualization.</b>
      </center>
      <br />
      <br />

      <a name="section_4_6" id="section_4_6"/>
      <h3>4.6 Colormap Selection</h3>

      <p>
	Voltage values are color coded using a colormap.  Six
	colormaps are available (<a href="#figure_7">Figure 7)</a>.  A
	colormap is selected from the Visualization pane's Vis Option
	tab.  <a href="#figure_11">Figure 11</a> shows the
	utahtorso-lowres model colored with the Red-to-Blue colormap
	selected, rather than the default Inverse Rainbow coloring.
      </p>
      <br />
      <br />

      <a name="figure_11" id="figure_11"/>
      <center>
	<img border="1" src="figures/biofem-vis-colormap.jpg"
	  alt="Red to Blue Colormap Visualization"/><br />
	<b>Figure 11: Visualization with the Red-to-Blue
	  colormap selected.</b>
      </center>
      <br />
      <br />

      <a id="appendix_a" name="appendix_a" />
      <h2>Appendix A&mdash;Data Formats and Preparation</h2>

      <p>
	<ins>Under construction</ins>
      </p>
      
      <center>
	<img src="images/footer.gif" alt="BioFEM bottom banner"/><br />
      </center>
    </div>
  </body>
</html>

<!-- Keep this comment at the end of the file
Local variables:
mode: xml
sgml-default-dtd-file:"../../../Utilities/XML/xhtml1-transitional.ced"
sgml-indent-data:yes
sgml-indent-step:2
sgml-omittag:nil
sgml-shorttag:nil
sgml-nofill-elements:("pre" "style" "br")
End:
-->
