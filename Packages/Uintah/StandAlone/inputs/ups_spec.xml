
<!--
   UPS_SPEC:
     This specification defines the valid tags, their attributes, and
     their values.  

   DTD/XML Schema:

     This file is similar to a DTD or an XML Schema, however we didn't
     use either of these approaches for the following reasons: DTD's
     do not (easily) allow you to have optional Tags and Tags that may
     appear in any order.  They also don't do (minimal) validation of
     the type of data in each tag.  XML Schema may actually allow for
     some or all of this type of validation, however, we don't have an
     XML library capable of using XML Schema (as libxml2 (the lib we
     use) doesn't (yet?) support it.  We could have tried using
     another XML library (off-line), such as Xerces, but we wanted the
     validation to take place as the code begins to execute.

   Format of this specification:

     spec: need  type  validValues

       need: OPTIONAL, REQUIRED, MULTIPLE   (Probably need MULTIPLE-REQ and MULTIPLE-OPT.
                                             Currently MULTIPLE means 0 or more...)
       type: DOUBLE, INTEGER, STRING, VECTOR, NO_DATA (NO_DATA means the tag doesn't have any
                                                    data (text) but can have attributes and/or
                                                    sub-tags.)

       validValues is a _single_ string (see below for how it is parsed) that contains valid values
       or the value of the tag.  The specification of valid values depends on the type of the tag:
  
         STRING: a comma separated lists of strings which enumerate
                 explicitly which values the string can take on. If 
                 valid values for a string are not provided, then
                 all strings will be accepted.
         INTEGER/DOUBLE: "positive" = a positive value, "num, num" =
                 min, max values.  If not specified, then any
                 integer/double will be accepted.
               
         VECTOR: not quite sure how to specify valid values for a
         vector yet...

       Probably need a way to specify that if one tag exists, then
       another is not valid... perhaps we need a few more of these type
       of things too.  Let me know if you run into cases like this
       that should be enumerated so that they can be validated.
-->


<Uintah_specification> 

  <!--===========================================================-->
  <!-- Begin Common Block -->
  <CommonTags>
    <!-- 
       Tags in this <CommonTags> block are used more than once in the
       Uintah_specification.  In the Uintah_specification, they
       should just be referenced as <tag/>.  Optionally, if the 
       OPTIONAL/REQUIRED spec has changed, they can be referred to as
       <tag spec="NEW_VALUE">
    -->

    <cylinder                   spec="OPTIONAL NO_DATA"
                                   attribute1="label    REQUIRED STRING"
                                   children="ALL_OR_NONE" >
      <bottom                   spec="REQUIRED VECTOR" />
      <top                      spec="REQUIRED VECTOR" />
      <radius                   spec="REQUIRED DOUBLE 'positive'" />
    </cylinder>

    <box                        spec="OPTIONAL NO_DATA"
                                   attribute1="label REQUIRED STRING"
                                   children="ALL_OR_NONE" >
      <min                      spec="OPTIONAL VECTOR" />
      <max                      spec="OPTIONAL VECTOR" />
    </box>

    <geom_object                spec="REQUIRED NO_DATA" >
      <box/>
      <cylinder/>

      <res                      spec="REQUIRED VECTOR" />
      <velocity                 spec="REQUIRED VECTOR" />
      <temperature              spec="REQUIRED DOUBLE" />
      <density                  spec="OPTIONAL DOUBLE" /> <!-- FIXME: is this really optional? -->
      <pressure                 spec="OPTIONAL DOUBLE" /> <!-- FIXME: is this really optional? -->

      <difference               spec="OPTIONAL NO_DATA" >
        <box                    spec="MULTIPLE" />
      </difference>
    </geom_object>

  </CommonTags>
  <!-- End Common Block -->
  <!--===========================================================-->

  <Meta                 spec="OPTIONAL NO_DATA">
    <title              spec="OPTIONAL STRING" />
  </Meta>

  <Time                   spec="REQUIRED NO_DATA">
    <maxTime              spec="REQUIRED DOUBLE  'positive'" />
    <max_Timesteps        spec="OPTIONAL INTEGER 'positive'" />
    <initTime             spec="REQUIRED DOUBLE  'positive'" />
    <delt_min             spec="REQUIRED DOUBLE  'positive'" />
    <delt_max             spec="REQUIRED DOUBLE  'positive'" />
    <delt_init            spec="OPTIONAL DOUBLE  'positive'" />
    <max_delt_increase    spec="OPTIONAL DOUBLE  'positive'" />
    <max_initial_delt     spec="OPTIONAL DOUBLE  'positive'" />
    <timestep_multiplier  spec="REQUIRED DOUBLE  'positive'" />
  </Time>

  <SimulationComponent  spec="OPTIONAL NO_DATA"> <!-- FIXME: is this really optional? -->
    <type               spec="REQUIRED STRING 'mpm, arches, ice, mpmice, mpmarches, impm'" />
  </SimulationComponent>

  <DataArchiver         spec="REQUIRED NO_DATA"
                                   children="ONE_OF(outputInterval, outputTimestepInterval)" >
      <filebase         spec="REQUIRED STRING" />
      <outputInterval   spec="OPTIONAL DOUBLE 'positive'" /> <!-- FIXME: only one of these should be allowed... -->
      <outputTimestepInterval spec="OPTIONAL INTEGER 'positive'" />
      <save             spec="MULTIPLE NO_DATA"
                        attribute1="label     REQUIRED STRING 
                            'press_equil_CC, vol_frac_CC, sp_vol_CC, uvel_FC, vvel_FC, wvel_FC, uvel_FCME, vvel_FCME,
                             wvel_FCME, delP_Dilatate, delP_MassX, press_CC, mass_L_CC, mom_source_CC, mom_L_ME_CC, vel_CC, rho_CC, rhs, 
                             scalar-f, speedSound_CC, temp_CC,
                             KineticEnergy, TotalIntEng, TotalMass, StrainEnergy, CenterOfMassPosition,
                             CenterOfMassVelocity, p.x, p.volume, p.stress, g.mass, g.stressFS'" />
      <!-- ???? IS checkpoint REALLY OPTIONAL???? -->
      <checkpoint       spec="OPTIONAL NO_DATA"
                        attribute1="interval  REQUIRED DOUBLE  'positive'"
                        attribute2="cycle     REQUIRED INTEGER 'positive'" />
      <outputDoubleAsFloat spec="OPTIONAL NO_DATA" />
      <compression         spec="OPTIONAL STRING 'gzip'" />
  </DataArchiver>

  <Debug                    spec="OPTIONAL NO_DATA" >
    <dbg_timeStart          spec="REQUIRED DOUBLE" />
    <dbg_timeStop           spec="REQUIRED DOUBLE" />
    <dbg_outputInterval     spec="REQUIRED DOUBLE" />
    <dbg_BeginIndex         spec="REQUIRED STRING" /> <!-- FIXME: HOW TO HANDLE VALUES LIKE: [[0,0,0]] -->
    <dbg_EndIndex           spec="REQUIRED STRING" /> <!-- FIXME: HOW TO HANDLE VALUES LIKE: [[0,0,0]] -->
    <dbg_Matls              spec="REQUIRED STRING" /> <!-- FIXME: HOW TO HANDLE VALUES LIKE: [0,1] -->
    <dbg_SigFigs            spec="OPTIONAL INTEGER '1, 20'" />
    <dbg_Level              spec="OPTIONAL INTEGER '1, 20'" />
    <dbg_SymmetryPlanes     spec="OPTIONAL INTEGER '1, 3'" />
    <dbg_Sym_absolute_tol   spec="OPTIONAL DOUBLE  'positive'" />
    <dbg_Sym_relative_tol   spec="OPTIONAL DOUBLE  'positive'" />
    <dbg_Sym_cutoff_value   spec="OPTIONAL DOUBLE  'positive'" />
    
    <debug              spec="MULTIPLE NO_DATA"
                        attribute1="label REQUIRED STRING 'switchTestConservation_abc, 
                                                           switchDebug_Initialize, 
                                                           switchDebug_equil_press, 
                                                           switchDebug_PressDiffRF, 
                                                           switchDebug_vel_FC, 
                                                           switchDebug_Temp_FC, 
                                                           switchDebug_Exchange_FC, 
                                                           switchDebug_explicit_press, 
                                                           switchDebug_setupMatrix, 
                                                           switchDebug_setupRHS, 
                                                           switchDebug_updatePressure, 
                                                           switchDebug_computeDelP, 
                                                           switchDebug_PressFC, 
                                                           switchDebug_LagrangianValues, 
                                                           switchDebug_LagrangianSpecificVol, 
                                                           switchDebug_LagrangianTransportedVars, 
                                                           switchDebug_MomentumExchange_CC, 
                                                           switchDebug_Source_Sink, 
                                                           switchDebug_advance_advect, 
                                                           switchDebug_conserved_primitive, 
                                                           switchDebug_AMR_refine, 
                                                           switchDebug_AMR_refineInterface, 
                                                           switchDebug_AMR_coarsen, 
                                                           switchDebug_AMR_reflux,
                                                           switchDebug_InterpolateNCToCC_0,
                                                           switchDebug_InterpolateCCToNC,
                                                           switchDebug_InterpolatePAndGradP'"/>
  </Debug>

  <InitialConditions    spec="OPTIONAL NO_DATA">
    <MPM                spec="OPTIONAL NO_DATA" />
    <ARCHES             spec="OPTIONAL NO_DATA" />
  </InitialConditions>

  <Grid                 spec="REQUIRED NO_DATA">

    <BoundaryConditions spec="OPTIONAL NO_DATA">
      <LODI             spec="OPTIONAL NO_DATA">
        <press_infinity spec="REQUIRED DOUBLE 'positive'" />
        <sigma          spec="REQUIRED DOUBLE '0, 1'"/>
        <ice_material_index spec="REQUIRED INTEGER '0, 6'"/>
      </LODI>    
      <SINE_BC          spec="OPTIONAL NO_DATA">
        <omega          spec="REQUIRED DOUBLE 'positive'"/>
        <A              spec="REQUIRED DOUBLE 'positive'"/>
      </SINE_BC>
      
      <Face             spec="MULTIPLE NO_DATA"
                        attribute1="side      REQUIRED STRING 'x-, x+, y-, y+, z-, z+'">
        <BCType         spec="MULTIPLE NO_DATA"
                        attribute1="id        REQUIRED STRING '0,1,2,3,5,6,all'"
                        attribute2="var       REQUIRED STRING 'Neumann, Dirichlet, symmetry, LODI, computeFromDensity, Sine'"
                        attribute3="label     REQUIRED STRING 'Pressure, Velocity, Temperature, Density, Symmetric, scalar-f, SpecificVol'" >
          <value        spec="OPTIONAL STRING" /> <!-- ERROR... it is required for some, but not for Dirichlet!!!
                                                       also, type can be different for different labels... how to handle? --> 
        </BCType>
      </Face>
    </BoundaryConditions>

    <Level              spec="MULTIPLE NO_DATA">
      <Box              spec="REQUIRED NO_DATA"
                           attribute1="label     REQUIRED STRING">
        <lower          spec="REQUIRED VECTOR" />
        <upper          spec="REQUIRED VECTOR" />
        <resolution     spec="OPTIONAL VECTOR" />
        <patches        spec="REQUIRED VECTOR" />
        <extraCells     spec="REQUIRED VECTOR" />
      </Box>
      <spacing          spec="OPTIONAL VECTOR" /> <!-- ????????? -->
      <periodic         spec="OPTIONAL VECTOR 'positive'"/>
    </Level>

  </Grid>

  <PhysicalConstants    spec="OPTIONAL NO_DATA"> <!-- FIXME: REALLY OPTIONAL??? -->
    <gravity            spec="REQUIRED VECTOR" />
    <reference_pressure spec="OPTIONAL DOUBLE" />
    <ideal_gas_constant spec="OPTIONAL DOUBLE" />
    <pressure           spec="OPTIONAL DOUBLE" />
    <viscosity          spec="OPTIONAL DOUBLE" />
  </PhysicalConstants>

  <CFD                                  spec="OPTIONAL NO_DATA" >

    <cfl                                spec="OPTIONAL INTEGER 'positive'" /> <!-- FIX ME: REALLY OPTIONAL??? -->
    <ICE                                spec="OPTIONAL NO_DATA" >
      <advection                        spec="REQUIRED NO_DATA" 
                                           attribute1="type REQUIRED STRING 'FirstOrder, SecondOrder'" />
    </ICE>        

    <ARCHES                             spec="OPTIONAL NO_DATA" >
      <grow_dt                          spec="REQUIRED DOUBLE 'positive'" />
      <variable_dt                      spec="REQUIRED BOOLEAN" />
      <nonlinear_solver                 spec="REQUIRED STRING 'explicit'" />
      <turbulence_model                 spec="REQUIRED STRING 'compdynamicprocedure'" />
      <transport_mixture_fraction       spec="REQUIRED BOOLEAN" />
      <transport_enthalpy               spec="REQUIRED BOOLEAN" />
      <model_mixture_fraction_variance  spec="REQUIRED BOOLEAN" />
      <Turbulence                       spec="REQUIRED NO_DATA" >
        <turbulentPrandtlNumber         spec="REQUIRED DOUBLE 'positive'" />
      </Turbulence>
      <Properties                       spec="REQUIRED NO_DATA" >
        <mixing_model                   spec="REQUIRED STRING 'coldFlowMixingModel'" />
        <ColdflowMixingModel            spec="REQUIRED NO_DATA" >
          <Stream                       spec="MULTIPLE NO_DATA" >
            <density                    spec="REQUIRED DOUBLE 'positive'" />
            <temperature                spec="REQUIRED DOUBLE" />
          </Stream>
        </ColdflowMixingModel>
      </Properties>

      <BoundaryConditions               spec="REQUIRED NO_DATA" >
        <FlowInlet                      spec="MULTIPLE NO_DATA" >
          <InletVelocity                spec="REQUIRED DOUBLE" />
          <mixture_fraction             spec="REQUIRED DOUBLE" />
          <geom_object/>
        </FlowInlet>

        <PressureBC                     spec="REQUIRED NO_DATA" >
          <mixture_fraction             spec="REQUIRED DOUBLE 'positive'" />
          <geom_object/>
        </PressureBC>

        <OutletBC                       spec="REQUIRED NO_DATA" >
          <mixture_fraction             spec="REQUIRED DOUBLE 'positive'" />
          <geom_object/>
        </OutletBC>
      </BoundaryConditions>

      <!-- FIXME: What is the different between this and the other PhysicalConstants? -->
      <PhysicalConstants                spec="REQUIRED NO_DATA" >
        <gravity                        spec="REQUIRED VECTOR" />
        <ref_point                      spec="REQUIRED VECTOR" />
        <viscosity                      spec="REQUIRED DOUBLE" />
      </PhysicalConstants>

      <ExplicitSolver                   spec="REQUIRED NO_DATA" >
        <timeIntegratorType             spec="REQUIRED STRING 'RK2SSP'" />
        <probe_data                     spec="REQUIRED BOOLEAN" />

        <PressureSolver                 spec="REQUIRED NO_DATA" >
          <linear_solver                spec="REQUIRED STRING 'hypre'" />
          <LinearSolver                 spec="REQUIRED NO_DATA" >
            <res_tol                    spec="REQUIRED DOUBLE" />
            <ksptype                    spec="REQUIRED STRING 'cg'" />
            <pctype                     spec="REQUIRED STRING 'pfmg" />
            <max_iter                   spec="REQUIRED INTEGER 'positive'" />
          </LinearSolver>
        </PressureSolver>

        <MomentumSolver                 spec="REQUIRED NO_DATA" >
          <convection_scheme            spec="REQUIRED STRING 'central'" />
        </MomentumSolver>

        <MixtureFractionSolver          spec="REQUIRED NO_DATA" >
          <convection_scheme            spec="REQUIRED STRING 'central-upwind'" />
        </MixtureFractionSolver>

      </ExplicitSolver>

    </ARCHES>

  </CFD>

  <Scheduler              spec="OPTIONAL NO_DATA">
    <VarTracker           spec="REQUIRED NO_DATA">
      <start_time         spec="REQUIRED DOUBLE" />
      <end_time           spec="REQUIRED DOUBLE" />
      <start_index        spec="REQUIRED VECTOR" />
      <end_index          spec="REQUIRED VECTOR" />
      <var                spec="MULTIPLE NO_DATA"
                          attribute1="label REQUIRED STRING"
                          attribute2="dw    REQUIRED STRING 'NewDW, OldDW'" />
    </VarTracker>
  </Scheduler>

  <MPM                    spec="OPTIONAL NO_DATA" >
    <time_integrator      spec="REQUIRED STRING 'explicit'" />
    <interpolator         spec="REQUIRED STRING 'gimp'" />
    <DoExplicitHeatConduction spec="OPTIONAL BOOLEAN" />
  </MPM>computeFromDensity

  <MaterialProperties               spec="OPTIONAL NO_DATA">
    <MPM                            spec="OPTIONAL NO_DATA">
      <material                     spec="REQUIRED NO_DATA">
        <density                    spec="REQUIRED DOUBLE" />
        <heat_transfer_coefficient  spec="OPTIONAL DOUBLE" />
        <constitutive_model         spec="REQUIRED NO_DATA"
                                       attribute1="type    REQUIRED STRING 'comp_mooney_rivlin" >
          <he_constant_1            spec="REQUIRED DOUBLE 'positive'" />
          <he_constant_2            spec="REQUIRED DOUBLE 'positive'" />
          <he_PR                    spec="REQUIRED DOUBLE 'positive'" />
        </constitutive_model>
        <thermal_conductivity       spec="REQUIRED DOUBLE 'positive'" />
        <specific_heat              spec="REQUIRED DOUBLE 'positive'" />
        <geom_object                spec="MULTIPLE" />
      </material>
      <contact                      spec="REQUIRED NO_DATA" >
        <type                       spec="REQUIRED STRING 'null, single_velocity'" />
        <materials                  spec="REQUIRED STRING" /> <!-- THIS IS WRONG.  What is [0]? -->
      </contact>
      <thermal_contact              spec="OPTIONAL NO_DATA" />
    </MPM>

    <ICE                      spec="OPTIONAL NO_DATA" > 
      <material               spec="MULTIPLE NO_DATA"
                              attribute1="name OPTIONAL STRING" >
        <EOS                  spec="REQUIRED NO_DATA"
                              attribute1="type REQUIRED STRING 'ideal_gas'" />
        <dynamic_viscosity    spec="REQUIRED DOUBLE 'positive'" />
        <thermal_conductivity spec="REQUIRED DOUBLE 'positive'" />
        <specific_heat        spec="REQUIRED DOUBLE 'positive'" />
        <gamma                spec="REQUIRED DOUBLE 'positive'" />

        <geom_object          spec="MULTIPLE" />
      </material>
    </ICE>

    <exchange_properties      spec="OPTIONAL NO_DATA" >
      <exchange_coefficients  spec="REQUIRED NO_DATA" >
        <momentum             spec="REQUIRED STRING" /> <!-- FIXME: not string, HOW TO HANDLE [1.0,1.0] -->
        <heat                 spec="REQUIRED STRING" /> <!-- FIXME: not string, HOW TO HANDLE [1.0,1.0] -->
      </exchange_coefficients>
    </exchange_properties>

  </MaterialProperties>

  <Models                     spec="OPTIONAL NO_DATA" >
    <Model                    spec="REQUIRED NO_DATA"
                              attribute1="type REQUIRED STRING" >
      <fromMaterial           spec="REQUIRED STRING 'source'" />
      <toMaterial             spec="REQUIRED STRING 'destination'" />
      <rate                   spec="REQUIRED DOUBLE" />
    </Model>
  </Models>

  <PhysicalBC                 spec="OPTIONAL NO_DATA" >
    <MPM                      spec="REQUIRED NO_DATA" >
      <force                  spec="MULTIPLE NO_DATA" >
        <lower                spec="REQUIRED VECTOR" />
        <upper                spec="REQUIRED VECTOR" />
        <force_density        spec="REQUIRED VECTOR" />
      </force>
    </MPM>
  </PhysicalBC>

</Uintah_specification>
